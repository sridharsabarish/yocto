# Exercise 2: Make #refined 
- [Make](https://www.gnu.org/software/make/manual/make.html) is an **automation tool** that is often used to improve the build process.
- Makefiles exists to help decide which part of a large program needs to be recompiled.
## Learning Outcome
- Refresher for the syntax of  Make 
- Learn how to build Makefile to automate the bitbake processes
## General Syntax
Composed of set of rules and a rule looks like :
```Makefile
targets: prerequisites
command
command
command
```

## Part 1: Getting Started #refined 
* For this part refer to `q1` folder.
1. Usually a Makefile is named as "Makefile" or "makefile", now we have a problem. Can you figure out how to run this file?

   <details>
   <summary>hint</summary>
   How do you force a make file?  Maybe there's a flag?
</details>

   <details>
   <summary>Answer</summary>
   You can read a file as make file by using the `-f` flag.
   `make -f  notamakefile.mk`
   </details>


## Part 2 : Here comes a kernel module #refined 
* Makefiles can also be used to build kernel modules in linux.
* Check the folder `q2`, in this example, we have a file `yocto_driver.c` and a makefile `Makefile`. Luckily this makefile is correct, so its all about calling the correct target.
   
  1. There are three targets, one prints the messages, one builds the yocto_driver and one cleans it up. Can you run them one by one?


   <details>
   <summary>hint</summary>
 You can run a target by using `make target`
</details>

   <details>
   <summary>Answer</summary>
  - make hello
  - make `build_kernel_module`
  - make `clean`
   </details>



  
2. There is an error here, I lied earlier.
   `yocto_driver.c` has some code commented out, maybe the comments have some clues?

   <details>
   <summary>hint</summary>
 Makefile is okay, its the c code thats buggy. Read the comments
</details>

   <details>
   <summary>Answer</summary>
	- Uncomment the first three commented lines  LICENSE, AUTHOR and DESCRIPTION. 
	- Uncomment the last line and change the argument to `yocto_driver_exit` instead of robot_driver_exit
</details>


## Part 3: Using Make for Yocto #refined  
In this segment we will see how a makefile could be used in the yocto processes. 

The question Q3-Q7 have some instructions and hints embedded in them. Feel free to check the radio boxes below once you are done. 


### Q3. Building and Cleaning an Image #refined 
- How did you build your image in the last exercise? You used 'bitbake core-image-minimal' right?, Make can automate this for you so you don't have to do it manually!!
- In this exercise, we will create two targets one to build the image and the other to clean. 
- Remember you need to source oe-init-build-env too!


### Q4. Running QEMU using Make
* By same logic, we could also run QEMU using a makefile instead, open q4 and see what it requires!

### Q5. Starting Toaster
* Can you try to run toaster from here? 
* How can you use make to restart toaster ?

### Q6. Some complex stuff
* Yocto is also used for complex stuff, this is a sneak peak to whats coming next!
* Go through the hints, if too difficult takea  look at the answer :P
# References

1. https://makefiletutorial.com/

