# Exercise 2: Make 

## Learning Outcome

- Refresher for the syntax of  Make 
- Learn how to build Makefile to automate the bitbake processes

## Make


- [Make](https://www.gnu.org/software/make/manual/make.html) is an **automation tool** that is often used to improve the build process.
- **Makefiles** exists to help decide which part of a large program needs to be recompiled.

### General Syntax

Composed of set of rules and a rule looks like :
```Makefile
targets: prerequisites
command
command
command
```

## Part 1: Getting Started 

*  Go to `/~/Downloads/Exercise2`, exercise files are present here.

*  Answer the question below by referring to the `q1` folder

1. Conventionally a Makefile is named as "Makefile" or "makefile", however in this example, we have a make file that has a different name.

   **Identify how to run this file?**
   <details>
   <summary>hint</summary>
   How do you force a make file?  Maybe there's a flag?
</details>
   <details>
   <summary>Answer</summary>
   You can read a file as make file by using the `-f` flag.
   `make -f  notamakefile.mk`
   </details>


## Part 2 :  Example : Building a Kernel module 

* In this example, we will use Makefiles and build kernel modules. 
* Check the folder `q2`, in this example, we have a file `yocto_driver.c` and a makefile `Makefile`. 

Luckily this makefile is correct, so its all about calling the correct target.
   
  2. There are three targets :  one prints the messages, one builds the yocto_driver and one cleans it up. 
  Can you run them one by one?
   <details>
   <summary>hint</summary>
 You can run a target by using `make target`
</details>
   <details>
   <summary>Answer</summary>
 The targets are `hello`, `build_kernel_module`,`clean`. Try to use make with it.
</details>
  
3. Due to some errors in yocto_driver.c the make operation is not successful.
`yocto_driver.c` has some code commented out, the comments provide some clues on how to rectify it. Try and fix it.

   <details>
   <summary>hint</summary>
   Check  the .c file and  read the comments

</details>
   <details>
   <summary>Answer</summary>
	- Uncomment the first three commented lines  LICENSE, AUTHOR and DESCRIPTION. 
	- Uncomment the last line and change the argument to yocto_driver_exit instead of robot_driver_exit
</details>

## Part 3: Make for Yocto 

- In this segment we will see how a make file could be used in yocto. 
- The question Q3-Q6 have some instructions and hints embedded in them. 

### Q3. Building and Cleaning an Image 

- In exercise 1, we used 'bitbake core-image-minimal' to build an image. This process can be automated by using Make.

- In this exercise, we will create two targets.

Target 1: perform build operation
Target 2: clean the build.

- **Note:**  `source oe-init-build-env` is required for these operations to work.


4. Open `q3` folder and explore the makefile inside it. The goal is to build the two targets.
   
   **Note: Answers are available in the solution folder for reference**

### Q4. Running QEMU using Make

5. QEMU can be run using a makefile as well, open `q4` and complete it to run QEMU from make

### Q5. Starting Toaster


6. Create a target that would start Toaster
7. Create a target that would restart toaster 

### Q6. Advanced use cases.

8. In Yocto, advanced operations can be performed. This section is a sneak peak to what's coming next!

* It is recommended to go through the hints. The answers can also be found in the **solutions folder!**

# References

1. https://makefiletutorial.com/

