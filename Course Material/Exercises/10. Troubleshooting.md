# Exercise on Troubleshooting
## Learning Outcomes 

* Learn common troubleshooting strategies
	* Learn when to how to add logging to recipes 
	*  Learn how to debug metadata variables.
	*  Learn how to inspect a package using oe-pkg-data util 
	*  Learn how to generate dependency graphs and view dependecy  
	* Learn how to use devshell
	* Lean how to enable GNU Debugger

## Part 1: Setting the Ground

Troubleshooting will an inevitable part of your yocto journey. Chances are you will be working with recipes and configuration files created others and it is crucial to understand how to debug when things go haywire.


But first, lets start with the simplest thing that you could do when it comes to troubleshooting, a.k.a logging i.e adding traces. 

1. We covered some examples previously, can you uncover what types of logs  we can use in our recipes?
   <details>
   <summary>Answer</summary>
    `bberror, bbfatal, bbwarn, bbnote,bbplain, bbdebug`

   </details>

2. There are tasks in python and some using the normal syntax, how does logging change when you use python instead of the normal syntax?
   <details>
   <summary>Hint</summary>
    its a minor difference

   </details>

   <details>
   <summary>Answer</summary>
    `bberror, bbfatal, bbwarn, bbnote,bbplain, bbdebug` is used in shell functions, however
    python uses 'bb.error() bb.fatal()' and so on.
   </details>



## Part 2 - Troubleshooting!

This next segment is an actual experience of troubleshooting with Yocto.

You have a bunch of recipes under `meta-exercises/recipes-troubleshooting`, the objective if time permits is to get them to work!

3. For this exercise, you will need to run `bitbake recipename`, you can find the recipes inside `recipes-troubleshooting` folder.

### Definition of Done
* If you can get a recipe to build successfully without errors, you are done with it!


## Part 3 - If time permits!!


### Bitbake Environment
4. There are so many places where a metadata could be updated so looking at a .bb files is not always enough!    

Take `core-image-full-cmdline` for example, this recipe, is used to build our very first image. 

Can you find out what are the values for the following here?
`SRC_URI` `IMAGE_INSTALL` `WORKDIR` `DISTRO` for this one?

Lets say we want to find  all Packages  are used in e` how can we do that by debugging?

   <details>
   <summary>Hint</summary>
    Can we use the bitbake env?

   </details>

   <details>
   <summary>Answer</summary>
    `bitbake -e core-image-full-cmdline | grep "^IMAGE_INSTALL="`
    This would give us the package groups used! Similarly we can find the other Values.

   </details>



### Some more troubleshooting methods.

5. Chances are you will run a recipe, the recipe will not throw any message, but that doesn't mean there are no logs!  Where can you find the logs?
   <details>
   <summary>Answer</summary>
   we can find it under the tmp/work directory like this for example.
	   `/home/yocto/work/poky/poky/build/tmp/work/core2-64-poky-linux/firstrec/1.0/temp/log.do_compile.21507`

   </details>

6. Maybe your recipe has dependencies, there could be a easy way to identify dependencies between recipes. What can you do to find dependencies of a recipe?

   <details>
   <summary>Answer</summary>
   Explore the dependency graph!

   </details>


   ### Dependency graph
3. How can you find dependencies of a recipe? 
   <details>
   <summary>hint</summary>
   Explore the dependency graph!
   `bitbake -g -u taskexp_ncurses recipe_name`
   </details>

4. Can you use this idea to find dependencies for  the recipes `bash` and `strace`

   <details>
   <summary>Answer</summary>
   Explore the dependency graph!
   `bitbake -g -u taskexp_ncurses strace`
   `bitbake -g -u taskexp_ncurses bash`
   </details>



   4.  Imagine, being handed a big system and you have to now find all recipes and packages that  are installed  here, how can we find that?

   <details>
   <summary>Hint</summary>
    Maybe we covered something in the previous exercises!
   </details>


   <details>
   <summary>Answer</summary>
    `oe-pkg-data-util` can be used!

   </details>



<!-- ###  Adding Support for GDB 

* Finally, in yocto we can enable support for extra debugging, and one such use case is the GDB.
* Read the  `local.conf` and enable support for GDB.
* Build the `core-image-full-cmdline`, boot the image using `runqemu core-image-full-cmdline nographic` and try to run `gdb` in the shell when it boots in qemu. -->


<!-- ### Devshell

9.  Try to open the recipe "gcc" with devshell, the goal is to add a new file to this recipe and try to create a patch!
 -->
